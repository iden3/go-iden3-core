# Relay

## Usage
In the `go-iden3/cmd/relay` directory, run:
```
go run main.go --config path-to-config/config.yaml start
```

Also can be build using:
```
go build
```

And then execute:
```
./relay
```

Will need to have a config file `config.yaml` with the following data:
```yaml
server:
  port: 5000
  privK: "serverprivatekey"
geth:
  url: "https://ropsten.infura.io/apitoken"
contractsAddress:
  identities: "identitiescontractaddress"
domain: "iden3.io"
namespace: "iden3.io"
```

## API Endpoints


### GET /root

Returns:
```js
{
  contractRoot: '0xfd89568c4dfe0b22be91c810421dcf02ac7ca42bc005461886a443fb6e0ead78',
  root: '0x0000000000000000000000000000000000000000000000000000000000000000'
}
```

### POST /claim/:idaddr
Input:
```js
{
  valueHex: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074353f867ef725411de05e3d4b0a01c37cf7ad24bcc213141a05ed7726d7932a1f0000000072e426fc590a60f0692df2f1e547cb92a546d2f02077bb3f0400dd62421c97220536fd6ed2be29228e8db1315e8c6d7525f4bdf4dad9966a2e7371f0a24b1929ed765c0e7a3f2b4665a76a19d58173308bb34062000000005b816b9e000000005b816b9e',
  signatureHex: '0xe136a057ea8d0bc79057c59aa31928a9400c5fcdbacd7b55d11a0f83c71cb27a4289b92e32357bb8f26973747be1497ff20eed382e3d9833aa52ae24a2d7db711b'
}
```

Returns:
```js
{
  claimProof: '0x0000000000000000000000000000000000000000000000000000000000000081dcc5d3d840663fc2e49825faaa9a48e215bb9a61ca566e55311567ad77374d53c50cd586a354cfe618bead4d3a65b1d8e391c74c9166b90ae0e6cb7d84ff277d',
  idRootProof: '0x00000000000000000000000000000000000000000000000000000000000000129df0ca90b13d691cd747e040e527d906415117d8554eaf522637eb6733e2b304b8193081f59feef7baab60cd827267371b2e6495cd2efab189370e0e2ea5819c',
  root: '0xca1c44c4996412f43730d8306ce9b1a9dbf2d94d6d44d239385c6b5decd5c23d'
}
```

### GET /claim/:idaddr/root

Returns:
```js
{
  idRoot: '0x0000000000000000000000000000000000000000000000000000000000000000',
  idRootProof: '0x0000000000000000000000000000000000000000000000000000000000000000',
  root: '0x0000000000000000000000000000000000000000000000000000000000000000'
}
```

### GET /claim/:idaddr/hi/:hi

Returns:
```js
{
  claimProof: {
    Leaf: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074353f867ef725411de05e3d4b0a01c37cf7ad24bcc213141a05ed7726d7932a1f00000000bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f2077bb3f0400dd62421c97220536fd6ed2be29228e8db1315e8c6d7525f4bdf4dad9966a2e7371f0a24b1929ed765c0e7a3f2b4665a76a19d58173308bb34062000000005b816b9e000000005b816b9e',
    Hi: '0x438a26007910a723fedf030efd08fed2d374634eb8866ce595c139ea341daa43',
    Proof: '0x0000000000000000000000000000000000000000000000000000000000000000',
    Root: '0xd1d3ebd84f46ec73767a2fe89930f33eef96ddf18c35e03faf03a98c8e6bf207'
  },
  setRootClaimProof: {
    Leaf: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c49694030749b9a76a0132a0814192c05c9321efc30c7286f6187f18fc6b6858214fe963e0e00000000bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9fd1d3ebd84f46ec73767a2fe89930f33eef96ddf18c35e03faf03a98c8e6bf207',
    Hi: '0xbadb12c663dc83678de0709619fb8c67f939b7a2c5c658a6305fa4841e62e392',
    Proof: '0x0000000000000000000000000000000000000000000000000000000000000000',
    Root: '0xfd89568c4dfe0b22be91c810421dcf02ac7ca42bc005461886a443fb6e0ead78'
  },
  claimNonRevocationProof: {
    Leaf: '0x0000000000000000000000000000000000000000000000000000000000000000',
    Hi: '0x1d4221032dae2392d162cf09030f5ad9fb135380a49bb1e8caf549aaea42b53f',
    Proof: '0x0000000000000000000000000000000000000000000000000000000000000004ce587b2d039c876de24e8b7fbdeb4cf6b84d542a60cdef47cf0ab29c631fba26',
    Root: '0xd1d3ebd84f46ec73767a2fe89930f33eef96ddf18c35e03faf03a98c8e6bf207'
  },
  setRootClaimNonRevocationProof: {
    Leaf: '0x0000000000000000000000000000000000000000000000000000000000000000',
    Hi: '0x28f5ee91e756ec1a3d1ea9ca2a68b5dde6ded3ea98effeadcefbff9a352aa434',
    Proof: '0x0000000000000000000000000000000000000000000000000000000000000002b8193081f59feef7baab60cd827267371b2e6495cd2efab189370e0e2ea5819c',
    Root: '0xfd89568c4dfe0b22be91c810421dcf02ac7ca42bc005461886a443fb6e0ead78'
  }
}
```



### POST /id
Input:
```js
{
  operational: '0x970e8128ab834e8eac17ab8e3812f010678cf791',
  recoverer: '0xe0fbce58cfaa72812103f003adce3f284fe5fc7c',
  revokator: '0x46b57a3f315f99a6de39406310f5bd0db03326c1'
}
```

Returns:
```js
{
  idaddr : '0x46b57a3f315f99a6de39406310f5bd0db03326c1'
}
```

### GET /id/:idaddr
Returns:
```js
{
  IDAddr: '0x46b57a3f315f99a6de39406310f5bd0db03326c1',
  LocalDb: {
    Operational: '0x970e8128ab834e8eac17ab8e3812f010678cf791',
    Relayer: '0xe0fbce58cfaa72812103f003adce3f284fe5fc7c',
    Recoverer: '0x970e8128ab834e8eac17ab8e3812f010678cf791',
    Revokator: '0x970e8128ab834e8eac17ab8e3812f010678cf791',
    Impl: '0x2623ed1533d47d56f912300ae40f83b9370cead6'
  },
  Onchain: null
}
```

### POST /id/:idaddr/deploy
Input:
```js
{}
```

Returns:
```js
{
  idaddr: '0x8435ebb41634c05019be1710be0007fa0d92861f',
  tx: '0x403859ccc701eb358d3a25c908c33de733cbb2d0ebc1c7738eed4908cc8cf5c4'
}
```

### POST /vinculateid
Input:
```js
{
  ethAddr: '0xbc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
  name: 'username',
  signature: '0xeda8b278eae69cd8c4863380f0af5cfe8360481790d8ea5c188705b552bc0d5e1384efb627db5b423d4a163ad02ca23a2f05eea5dc787ac5837789aa95f50f101b'
}
```

Returns:
```js
{
  assignNameClaim: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074b7ae3d3a2056c54f48763999f3ff99caffaaba3bab58cae900000080000000008a440962fb17f0fe928a3d930137743fe63b8f4c0ce5a5da63991310103d9aef3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
  ethAddr: '0xbc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
  name: 'username',
  proofOfRelayClaim: {
    ClaimProof: {
      Leaf: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074b7ae3d3a2056c54f48763999f3ff99caffaaba3bab58cae900000080000000008a440962fb17f0fe928a3d930137743fe63b8f4c0ce5a5da63991310103d9aef3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
      Proof: '0x000000000000000000000000000000000000000000000000000000000000001b965466f7bed2823acd51bad184f7dc0b89b7cfc5ee5d897f8fc65949d4dd6ba875f58d98a602ff1faab66b4560660be0e0b540e43fdac311215abc81665dccb618a13865757f4ea7ff910c9121de8443fdbd151cbd2b4fe4da87302ac2faf66caf677f70fad9050c9d8e77b727fe6d29187c054cd47cfb3fcc10b2a4cbf08f8c',
      Root: '0x2610d480d721bfc8359cb240d028bd009a6625eb801b76c560e147a4c7424f0b'
    },
    ClaimNonRevocationProof: {
      Leaf: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074b7ae3d3a2056c54f48763999f3ff99caffaaba3bab58cae900000080000000018a440962fb17f0fe928a3d930137743fe63b8f4c0ce5a5da63991310103d9aef3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
      Proof: '0x000000000000000000000000000000000000000000000000000000000000001b87961d8f6a5fae0286889da0443295eb2e03c1fa40aa61ae3394aa12f81a302e7d2ff8e70da77ef7559614425aa33021eb88752f63a690911c031a1fae273f9393b3f57a79800ca02cd1ac3a555d9dbb7d5869251d51d34e01d7de4ab811e975e83789789c24d79c1b593ebda50e4da3bbebd4d582d5fbad5431b148cdca40f5',
      Root: '0x2610d480d721bfc8359cb240d028bd009a6625eb801b76c560e147a4c7424f0b'
    },
    Date: 1539101017,
    Signature: '0x6b92b9c769add357fda2df91962e7751d2c2d61b0a652c235a589187956614356eabf3634ca3dadc152304a7aa74dc0c7e64204e6c47a7366d100c695bd7074001'
  }
}
```



### GET /identities/resolv/:nameid
Returns:
```js
{
  claim: '0x3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074b7ae3d3a2056c54f48763999f3ff99caffaaba3bab58cae900000080000000008a440962fb17f0fe928a3d930137743fe63b8f4c0ce5a5da63991310103d9aef3cfc3a1edbf691316fec9b75970fbfb2b0e8d8edfc6ec7628db77c4969403074bc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f',
  ethAddr: '0xbc8c480e68d0895f1e410f4e4ea6e2d6b160ca9f'
}
```
